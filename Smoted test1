local plr = game.Players.LocalPlayer
local hum = plr.Character or plr.CharacterAdded:Wait():WaitForChild("Humanoid")
local RS = game.ReplicatedStorage
local LatestRoom = RS:WaitForChild("GameData"):WaitForChild("LatestRoom")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

--=== GUI CẢNH BÁO DON'T MOVE ===--
local function createDontMoveGUI()
	local gui = Instance.new("ScreenGui")
	gui.Name = "DontMoveWarning_TEST"
	gui.IgnoreGuiInset = true
	gui.Parent = plr.PlayerGui

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 0.15, 0)
	label.Position = UDim2.new(0, 0, 0.42, 0)
	label.Text = "DON'T MOVE"
	label.BackgroundTransparency = 1
	label.Font = Enum.Font.FredokaOne
	label.TextColor3 = Color3.fromRGB(255, 0, 0)
	label.TextSize = 80
	label.Parent = gui

	-- rung lắc chữ
	task.spawn(function()
		while gui.Parent do
			label.Rotation = math.random(-8, 8)
			task.wait(0.05)
		end
	end)

	return gui
end

--=== JUMPSCARE PHẠT ===--
local function triggerPunishment()
	local gui = Instance.new("ScreenGui")
	gui.Name = "TestPunishScreen"
	gui.IgnoreGuiInset = true
	gui.Parent = plr.PlayerGui

	local face = Instance.new("ImageLabel")
	face.Image = "rbxassetid://14521815351"
	face.ImageTransparency = 0.4
	face.Size = UDim2.new(0.2,0,0.2,0)
	face.Position = UDim2.new(0.4,0,0.4,0)
	face.BackgroundTransparency = 1
	face.Parent = gui

	-- tween lớn hình
	TweenService:Create(
		face,
		TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
		{Size = UDim2.new(1,0,1,0), Position = UDim2.new(0,0,0,0)}
	):Play()

	-- âm thanh
	local s = Instance.new("Sound")
	s.SoundId = "rbxassetid://6891548543"
	s.Volume = 5
	s.Parent = gui
	s:Play()

	task.delay(1, function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/eoyoustme/back/refs/heads/main/Smoted1"))()
	end)
end

--=== MAIN: TEST 100% ===--
LatestRoom.Changed:Connect(function()
	print("[TEST] DON'T MOVE EVENT - 100%")

	local warningGUI = createDontMoveGUI()
	task.wait(1)  -- đợi 1 giây sau khi hiện cảnh báo

	local punished = false

	--=== DÙNG HEARTBEAT ĐỂ KIỂM TRA NGƯỜI CHƠI DI CHUYỂN ===--
	local hb
	hb = RunService.Heartbeat:Connect(function()
		if punished then return end

		if hum.MoveDirection.Magnitude > 0 then
			punished = true

			-- xóa warning
			if warningGUI then 
				warningGUI:Destroy()
			end

			hb:Disconnect()
			triggerPunishment()
		end
	end)
end)
