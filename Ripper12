game.ReplicatedStorage.GameData.LatestRoom.Changed:Wait()

--====== Load spawner ======--

local spawner = loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Entity%20Spawner/V2/Source.lua"))()

--====== Create entity ======--

local entity = spawner.Create({
	Entity = {
		Name = "Ripper",
		Asset = "rbxassetid://130339930471583",
		HeightOffset = 1
	},
	Lights = {
		Flicker = {Enabled = false, Duration = 1},
		Shatter = false,
		Repair = false
	},
	Earthquake = {Enabled = true},
	CameraShake = {
		Enabled = true,
		Range = 100,
		Values = {10.5, 40, 0.1, 1}
	},
	Movement = {Speed = 125, Delay = 5.771, Reversed = false},
	Rebounding = {Enabled = false, Type = "Ambush", Min = 2, Max = 2, Delay = 0.2},
	Damage = {Enabled = true, Range = 40, Amount = 0.01},
	Crucifixion = {Enabled = true, Range = 40, Resist = false, Break = true},
	Death = {Type = "Guiding", Hints = {"Death", "Hints", "Go", "Here"}, Cause = ""}
})

--====== Callbacks ======--

entity:SetCallback("OnSpawned", function()
	print("Entity spawned")
end)

entity:SetCallback("OnStartMoving", function()
	print("Ripper is moving")
end)

entity:SetCallback("OnEnterRoom", function(room, firstTime)
	if firstTime then
		entity.Config.Movement.Speed *= 1.2
	end
end)

entity:SetCallback("OnDamagePlayer", function(newHealth)
	if newHealth == 0 then
		print("Player killed")
		return
	end

	print("Player damaged ‚Äî JUMPSCARE!")

	---------------------------------------------------------
	--                 JUMPSCARE STARTS HERE
	---------------------------------------------------------
	task.spawn(function()
		local Players = game:GetService("Players")
		local RunService = game:GetService("RunService")
		local TweenService = game:GetService("TweenService")

		local player = Players.LocalPlayer
		local character = player.Character or player.CharacterAdded:Wait()
		local humanoid = character:WaitForChild("Humanoid")
		local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
		local camera = workspace.CurrentCamera

		-- üî• L·∫§Y ENTITY MODEL TH·∫¨T TRONG ROOM CH·ª® KH√îNG PH·∫¢I WORKSPACE
		local latestRoom = tostring(game.ReplicatedStorage.GameData.LatestRoom.Value)
		local room = workspace.CurrentRooms:FindFirstChild(latestRoom)

		if not room then warn("Room not found!") return end

		local entityModel = room:FindFirstChild("Ripper") or room:WaitForChild("Ripper", 5)
		if not entityModel then warn("‚ùå Entity model not found") return end

		local primaryPart = entityModel:FindFirstChild("Ripe")
		if not primaryPart then warn("‚ùå Missing primary part 'Ripe'") return end

		-- kh√≥a ƒëi·ªÅu khi·ªÉn
		local originalWalk = humanoid.WalkSpeed
		local originalJump = humanoid.JumpPower

		humanoid.WalkSpeed = 0
		humanoid.JumpPower = 0

		local controls = require(player.PlayerScripts.PlayerModule):GetControls()
		controls:Disable()

		-- entity bay v√†o m·∫∑t player
		local track = true
		task.spawn(function()
			while track and primaryPart.Parent and humanoidRootPart.Parent do
				local target = humanoidRootPart.CFrame
				local tw = TweenService:Create(primaryPart, TweenInfo.new(20000000, Enum.EasingStyle.Quad), {CFrame = target})
				tw:Play()
				tw.Completed:Wait()
			end
		end)

		wait(0.35)

		-- ‚ùå T·∫Øt to√†n b·ªô particles tr∆∞·ªõc khi chuy·ªÉn texture
		for _, d in ipairs(entityModel:GetDescendants()) do
			if d:IsA("ParticleEmitter") then
				d.TimeScale = 0
			end
		end

		--------------------------------------------------------------------
		-- üî• T√åM ATTACHMENT "Ripe" ‚Üí T√åM PARTICLE "2" ‚Üí ƒê·ªîI TEXTURE
		--------------------------------------------------------------------
		task.spawn(function()
			local ripeAttachment = primaryPart:FindFirstChild("Ripe") or primaryPart:FindFirstChildWhichIsA("Attachment")

			if not ripeAttachment then
				warn("‚ùå No attachment named Ripe found")
				return
			end

			local emitter = ripeAttachment:FindFirstChild("2")

			if emitter and emitter:IsA("ParticleEmitter") then
				emitter.Texture = "rbxassetid://16025871152"
				emitter.Enabled = true
				emitter.TimeScale = 1
				print("‚úî ParticleEmitter '2' texture changed successfully!")
			else
				warn("‚ùå ParticleEmitter '2' not found")
			end
		end)
		--------------------------------------------------------------------

		camera.CameraType = Enum.CameraType.Scriptable

		local lockConn
		lockConn = RunService.RenderStepped:Connect(function()
			if not primaryPart or not primaryPart.Parent then
				if lockConn then lockConn:Disconnect() end
				return
			end
			camera.CFrame = CFrame.lookAt(camera.CFrame.Position, primaryPart.Position)
		end)

		-- ===== Play Sounds =====
		local function GetSoundFromGit(url, name)
			if not isfile(name..".mp3") then
				writefile(name..".mp3", game:HttpGet(url))
			end
			local s = Instance.new("Sound")
			s.SoundId = (getcustomasset or getsynasset)(name..".mp3")
			return s
		end

		local jumpscare = GetSoundFromGit("https://github.com/eoyoustme/back/raw/main/Kill_with_static.mp3","Kill")
		jumpscare.Parent = workspace
		jumpscare.Volume = 1
		jumpscare:Play()

		-- ===== UI FLASH =====
		local gui = Instance.new("ScreenGui", player.PlayerGui)
		gui.IgnoreGuiInset = true

		local img = Instance.new("ImageLabel", gui)
		img.Size = UDim2.fromScale(1,1)
		img.BackgroundTransparency = 1
		img.ImageTransparency = 1

		local img1 = "rbxassetid://94547864377343"
		local img2 = "rbxassetid://236542974"

		img.Image = img1
		TweenService:Create(img, TweenInfo.new(1), {ImageTransparency = 0}):Play()

		local t = tick()
		while tick() - t < 1.4 do
			img.Image = img1
			task.wait()
			img.Image = img2
			task.wait()
		end

		img.ImageTransparency = 1

		-- death hint
		firesignal(game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent,{
			"You died to who you call Ripper",
			"He will get faster every room he goes.",
			"Hide in a closet if he spawns."
		},"Blue")

		track = false
		humanoid.Health = 0

		if lockConn then lockConn:Disconnect() end
		camera.CameraType = Enum.CameraType.Custom

	end)
end)

--====== Run entity ======--
entity:Run()
