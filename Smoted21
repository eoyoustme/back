-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- VARIABLES
local plr = Players.LocalPlayer
local chr = plr.Character or plr.CharacterAdded:Wait()
local humrp = chr:WaitForChild("HumanoidRootPart")
local speed = 0.001 -- tốc độ entity
local Move = true

-- HÀM PUNISH GUI / JUMPSCARE
local function triggerPunishment()
    -- GUI
    local gui = Instance.new("ScreenGui")
    gui.Name = "PunishScreen"
    gui.IgnoreGuiInset = true
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    gui.Parent = plr.PlayerGui

    local face = Instance.new("ImageLabel")
    face.Image = "rbxassetid://14521815351"
    face.ImageTransparency = 0.4
    face.Size = UDim2.new(0.2,0,0.2,0)
    face.Position = UDim2.new(0.4,0,0.4,0)
    face.BackgroundTransparency = 1
    face.Parent = gui

    -- Tween lớn toàn màn hình
    TweenService:Create(face, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
        Size = UDim2.new(1,0,1,0),
        Position = UDim2.new(0,0,0,0)
    }):Play()

    -- Sound
    local s = Instance.new("Sound")
    s.SoundId = "rbxassetid://6891548543"
    s.Volume = 5
    s.Parent = gui
    s:Play()

    -- Tự hủy GUI sau 2 giây
    task.delay(1, function()
        gui:Destroy()
    end)
end

-- ENTITY SPAWN
local entityModel = game:GetObjects("rbxassetid://97510678068018")[1]
entityModel.Parent = workspace
local Primary = entityModel:FindFirstChildWhichIsA("BasePart")
entityModel.PrimaryPart = Primary
entityModel:SetPrimaryPartCFrame(humrp.CFrame * CFrame.new(0,0,30)) -- ban đầu 30 studs

-- HÀM KIỂM TRA NGƯỜI CHƠI NHÌN ENTITY
local function isLookingAt()
    local cam = workspace.CurrentCamera
    local camDir = cam.CFrame.LookVector
    local dirToEntity = (Primary.Position - cam.CFrame.Position).Unit
    return camDir:Dot(dirToEntity) > 0.5
end

-- TELEPORT 10 STUDS nếu không nhìn
task.spawn(function()
    while entityModel and Move do
        if not isLookingAt() then
            if entityModel.PrimaryPart then
                local offset = humrp.CFrame.LookVector * 10 -- 10 studs
                entityModel:SetPrimaryPartCFrame(humrp.CFrame + offset)
            end
        end
        task.wait(2)
    end
end)

-- CHASE PLAYER
RunService.Heartbeat:Connect(function(dt)
    if not Move or not entityModel or not entityModel.PrimaryPart or not humrp then return end
    local pos = entityModel.PrimaryPart.Position
    local target = humrp.Position
    local dir = (target - pos).Unit
    local moveVec = dir * speed * dt
    local newCFrame = CFrame.new(pos + moveVec, target)
    entityModel:SetPrimaryPartCFrame(newCFrame)
end)

-- KHI ENTITY CHẠM PLAYER
local entityPart = entityModel:FindFirstChild("Smoted")
if entityPart then
    entityPart.Touched:Connect(function(hit)
        local h = hit.Parent and hit.Parent:FindFirstChild("Humanoid")
        if h and hit:IsDescendantOf(chr) then
            Move = false
            h:TakeDamage(200)

            -- Ghi thống kê
            local stats = ReplicatedStorage:WaitForChild("GameStats")
            if stats:FindFirstChild("Player_" .. plr.Name) then
                stats["Player_" .. plr.Name].Total.DeathCause.Value = "Smoted"
            end

            -- Chạy jumpscare
            triggerPunishment()
            -- Hoặc loadstring nếu muốn load từ web:
            -- loadstring(game:HttpGet("https://raw.githubusercontent.com/eoyoustme/back/refs/heads/main/Jumpscare"))()
        end
    end)
end

-- TỰ HỦY ENTITY SAU 80–125 GIÂY
task.delay(math.random(80,125), function()
    Move = false
    task.wait(0.5)
    if entityModel.PrimaryPart then
        entityModel:SetPrimaryPartCFrame(entityModel.PrimaryPart.CFrame + Vector3.new(0,-100,0))
    end
    task.wait(1)
    if entityModel then
        entityModel:Destroy()
    end
end)
