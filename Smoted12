local function triggerPunishment()
	-- GUI jump scare
	local gui = Instance.new("ScreenGui")
	gui.Name = "PunishScreen"
	gui.IgnoreGuiInset = true
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	gui.Parent = plr.PlayerGui

	local face = Instance.new("ImageLabel")
	face.Image = "rbxassetid://14521815351"
	face.ImageTransparency = 0.4
	face.Size = UDim2.new(0.2,0,0.2,0)
	face.Position = UDim2.new(0.4,0,0.4,0)
	face.BackgroundTransparency = 1
	face.Parent = gui

	-- Tween lớn hết màn hình
	TweenService:Create(
		face,
		TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
		{
			Size = UDim2.new(1,0,1,0),
			Position = UDim2.new(0,0,0,0)
		}
	):Play()

	-- Âm thanh
	local s = Instance.new("Sound")
	s.SoundId = "rbxassetid://6891548543"
	s.Volume = 5
	s.Parent = gui
	s:Play()


local plr = game.Players.LocalPlayer
local chr = plr.Character or plr.CharacterAdded:Wait()
local humrp = chr:WaitForChild("HumanoidRootPart")
local RunService = game:GetService("RunService")

local speed = 0.001
local Move = true

local entityModel = game:GetObjects("rbxassetid://97510678068018")[1]
entityModel.Parent = workspace
local Primary = entityModel:FindFirstChildWhichIsA("BasePart")
entityModel.PrimaryPart = Primary
entityModel:SetPrimaryPartCFrame(humrp.CFrame * CFrame.new(0, 0, 30))

--=== KIỂM TRA NGƯỜI CHƠI CÓ NHÌN ENTITY KHÔNG ===--
local function isLookingAt()
	local cam = workspace.CurrentCamera
	local camDir = cam.CFrame.LookVector
	local dirToEntity = (Primary.Position - cam.CFrame.Position).Unit

	local dot = camDir:Dot(dirToEntity)
	-- Nếu dot > 0.5 tức đang nhìn entity
	return dot > 0.5
end

--=== CƠ CHẾ TELEPORT ===--
task.spawn(function()
	while entityModel and Move do
		if not isLookingAt() then
			if entityModel and entityModel.PrimaryPart then
				local lookPos = humrp.CFrame.LookVector * 10
				entityModel:SetPrimaryPartCFrame(humrp.CFrame + lookPos)
			end
		end
		task.wait(2)
	end
end)

--=== CHASE ENTITY (DI CHUYỂN ĐUỔI) ===--
RunService.Heartbeat:Connect(function(dt)
	if not Move or not entityModel or not entityModel.PrimaryPart or not humrp then return end
	local pos = entityModel.PrimaryPart.Position
	local target = humrp.Position
	local dir = (target - pos).Unit
	local moveVec = dir * speed * dt
	local newCFrame = CFrame.new(pos + moveVec, target)
	entityModel:SetPrimaryPartCFrame(newCFrame)
end)

--=== KHI ENTITY CHẠM PLAYER ===--
local entityPart = entityModel:FindFirstChild("Smoted")
if entityPart then
	entityPart.Touched:Connect(function(hit)
		local h = hit.Parent and hit.Parent:FindFirstChild("Humanoid")
		if h and hit:IsDescendantOf(chr) then
			Move = false   -- Dừng đuổi
			h:TakeDamage(200)

			-- ghi thống kê
			local stats = game:GetService("ReplicatedStorage").GameStats
			if stats:FindFirstChild("Player_" .. plr.Name) then
				stats["Player_" .. plr.Name].Total.DeathCause.Value = "Smoted"
			end

			--=== CHẠY JUMPSCARE ===--
			loadstring(game:HttpGet("https://raw.githubusercontent.com/eoyoustme/back/refs/heads/main/Jumpscare"))()
		end
	end)
end

--=== TỰ HỦY ENTITY ===--
task.delay(math.random(80,125), function()
	Move = false
	wait(0.5)
	if entityModel and entityModel.PrimaryPart then
		entityModel:SetPrimaryPartCFrame(entityModel.PrimaryPart.CFrame * CFrame.new(1000, -100, 1000))
	end
	wait(1)
	if entityModel then
		entityModel:Destroy()
	end
end)
